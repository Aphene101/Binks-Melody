import{d as o,a as i,g as h,c as E,b as l,s as c,e as I,f as C,h as v,i as x}from"./main-BsRMFtTf.js";console.log("signup.js is loaded");document.addEventListener("DOMContentLoaded",()=>{console.log("DOM fully loaded");const u=document.getElementById("sign-up-form"),m=document.getElementById("sign-up-username"),g=document.getElementById("sign-up-email"),p=document.getElementById("sign-up-password"),a=document.getElementById("sign-up-error");if(!u){console.error("Form not found!");return}u.addEventListener("submit",async f=>{console.log("submit noticed"),f.preventDefault();const s=m.value.trim(),r=g.value.trim(),d=p.value;if(!s||!r||!d){a.textContent="All fields are required.";return}const y=o(i,"usernames",s);if((await h(y)).exists()){a.textContent="Username is already taken.";return}let t;try{console.log("try block opened"),t=await E(l,r,d);const e=t.user,n=e.uid;await c(o(i,"usernames",s),{email:r,userId:n}),await c(o(i,"users",n),{}),await I(e),await C(n),await v(l),alert("Account created! Please verify your email before logging in."),onAuthStateChanged(l,w=>{w||(window.location.replace="./index.html")})}catch(e){if(console.error("Signup error:",e),t&&t.user)try{await x(t.user),console.log("Deleted partially registered user due to error.")}catch(n){console.warn("Could not delete user after failed signup:",n)}e.code==="auth/email-already-in-use"?a.textContent="This email is already registered.":a.textContent=e.message||"Signup failed."}})});

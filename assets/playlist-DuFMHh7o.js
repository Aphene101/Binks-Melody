import{b as S,e as A,i as u,f as E,h as C,j as L,u as I,k as h}from"./firebase-Dt0rUM0f.js";import{g as k}from"./jamendo-xwmukEKB.js";import"./main-Ce-q2Rcz.js";const b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8Xw8AAuMBgVdPxT8AAAAASUVORK5CYII=",B=new URLSearchParams(window.location.search),f=B.get("genre");let m=B.get("id");console.log("Playlist ID from URL:",m);!m&&!f&&(alert("No playlist selected. Redirecting to playlists page."),window.location.href="./playlists.html");const T=document.getElementById("pl-back")||null,w=document.getElementById("pl-name")||null,l=document.getElementById("pl-icon")||null,y=document.getElementById("pl-songs")||null;let v=null,p=null;const c=document.createElement("div");c.className="song-popup hidden";c.innerHTML=`
  <div class="popup-item" id="pl-removeFromPlaylistBtn">
    <img src="/Binks-Melody/Media/Delete-Icon.svg" alt="Remove">
    <span>Remove from Playlist</span>
  </div>
`;document.body.appendChild(c);function M(n,e){p=e;const t=n.getBoundingClientRect();c.style.top=`${t.bottom+window.scrollY}px`,c.style.left=`${t.left+window.scrollX}px`,c.classList.remove("hidden")}document.addEventListener("click",n=>{c.contains(n.target)||c.classList.add("hidden")});async function R(n,e,t){const a=A(u,"users",n,"playlists",e),s=await E(a);if(s.exists()&&Array.isArray(s.data().songs)){const r=(s.data().songs||[]).filter(i=>(i.id??i.audio)!==(t.id??t.audio));await I(a,{songs:r})}else if(t.id){const o=A(u,"users",n,"playlists",e,"songs",t.id);await h(o)}else{const o=C(u,"users",n,"playlists",e,"songs"),i=(await L(o)).docs.find(g=>(g.data().id??g.data().audio)===(t.id??t.audio));i&&await h(i.ref)}}document.getElementById("pl-removeFromPlaylistBtn")?.addEventListener("click",async()=>{if(c.classList.add("hidden"),!v||!m||!p)return;await R(v,m,p);const e=[...document.querySelectorAll(".song-item")].find(t=>t.querySelector(".song-title")?.textContent===(p.name||p.title));e?.parentElement?.nextElementSibling?.remove?.(),e?.parentElement?.remove?.()});T?.addEventListener("click",()=>{f?window.location.href="home.html":window.location.href="playlists.html"});S.onAuthStateChanged(async n=>{if(f){await $(f);return}if(!m){console.warn("No playlist id found");return}n&&(v=n.uid,await U(n.uid,m))});async function U(n,e){console.log("Loading playlists");const t=A(u,"users",n,"playlists",e),a=await E(t);if(!a.exists())return;console.log(a+"The snap is above");const s=a.data();w&&(w.textContent=s.name||"Untitled Playlist");let o=[];if(Array.isArray(s.songs)&&s.songs.length)o=s.songs;else{const i=C(u,"users",n,"playlists",e,"songs");o=(await L(i)).docs.map(d=>({id:d.id,...d.data()}))}const r=o[0]?.album_image||o[0]?.albumArt||o[0]?.cover||"";l&&(r?(l.style.backgroundImage=`url(${r})`,l.style.backgroundColor="transparent",l.style.backgroundSize="cover",l.style.backgroundPosition="center"):l.style.backgroundImage="none"),console.log(o),P(o)}async function $(n){const e=n.charAt(0).toUpperCase()+n.slice(1);w.textContent=e;const t=await k(n,10),a=t[0]?.album_image||"";a?(l.style.backgroundImage=`url(${a})`,l.style.backgroundColor="transparent",l.style.backgroundSize="cover",l.style.backgroundPosition="center"):l.style.backgroundImage="none",P(t)}function P(n){y&&(y.innerHTML="",n.forEach((e,t)=>{const a=document.createElement("div"),s=document.createElement("div");s.className="song-item";const o=e.name||e.title||"Unknown Title",r=e.artist_name||e.artist||"Unknown Artist",i=e.album_image||e.albumArt||e.cover||"";s.innerHTML=`
      <div class="song-left">
        <div class="song-thumb">
          <img src="${i||b}" alt="" onerror="this.src='${b}'">
        </div>
        <div class="song-info">
          <span class="song-title">${o}</span>
          <span class="song-artist">${r}</span>
        </div>
      </div>
      <button class="song-menu">
        <img class="more-icon" src="/Binks-Melody/Media/More-icon.svg">
      </button>
    `,a.appendChild(s);const g=document.createElement("hr");g.classList.add("song-separator"),y.appendChild(a),y.appendChild(g),s.querySelector(".song-menu")?.addEventListener("click",d=>{d.stopPropagation(),M(d.currentTarget,e)}),s.addEventListener("click",()=>{const d=new CustomEvent("play-request",{detail:{track:e,index:t,playlist:n}});window.dispatchEvent(d)})}))}

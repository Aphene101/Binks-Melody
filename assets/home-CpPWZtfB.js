import"./firebase-DtfHErYr.js";import"./main-Frh6MUDs.js";const $="804bfeee";async function q(e){const t=`https://api.jamendo.com/v3.0/tracks/?client_id=${$}&format=json&limit=10&search=${encodeURIComponent(e)}`;return(await(await fetch(t)).json()).results}const P=document.querySelector(".search-input"),C=document.querySelector(".section-title"),T=document.querySelector(".grid-container"),m=document.getElementById("search-results"),o=document.getElementById("player-audio"),A=document.getElementById("p-title"),z=document.getElementById("p-artist"),S=document.getElementById("p-cover"),H=document.getElementById("p-current"),_=document.getElementById("p-duration"),f=document.getElementById("p-seek"),B=document.getElementById("p-play"),j=document.getElementById("p-prev"),D=document.getElementById("p-next"),u=document.getElementById("play-icon");let c=[],l=-1,d,r,I,g;function R(e){m.innerHTML="",e.forEach((t,n)=>{const a=document.createElement("div"),i=document.createElement("div");i.classList.add("song-item"),i.innerHTML=`
        <div class="song-left">
            <div class="song-thumb">
            <img src="${t.album_image}" alt="Album Art">
            </div>
            <div class="song-info">
            <span class="song-title">${t.name}</span>
            <span class="song-artist">${t.artist_name}</span>
            </div>
        </div>
        <button class="song-menu">
            <img class="more-icon" src="/Binks-Melody/Media/More-icon.svg">
        </button>
        `,i.querySelector(".song-left").addEventListener("click",()=>{v(t.audio,t,n,e)}),a.appendChild(i);const s=document.createElement("hr");s.classList.add("song-separator"),a.appendChild(s),m.appendChild(a)})}function W(){if(!d){d=new(window.AudioContext||window.webkitAudioContext),I=d.createMediaElementSource(o),r=d.createAnalyser(),r.fftSize=256;const e=r.frequencyBinCount;g=new Uint8Array(e),I.connect(r),r.connect(d.destination)}}function v(e,t,n,a){A.textContent=t.name,z.textContent=t.artist_name,S.src=t.album_image,u.src="/Binks-Melody/Media/Pause-icon.svg",document.getElementById("player").classList.add("open"),o.pause();const i=new URL(e),s=`https://jamendo-proxy.aphene-falcon.workers.dev${i.pathname}${i.search}`;o.src=s,o.load(),c=a,l=n,f.value=0,W(),o.addEventListener("canplay",function h(){o.removeEventListener("canplay",h),o.play().catch(E=>{console.warn("Playback failed:",E)})})}o.addEventListener("loadedmetadata",()=>{_.textContent=k(o.duration)});o.addEventListener("timeupdate",()=>{if(o.duration){const e=o.currentTime/o.duration*100;f.value=e,H.textContent=k(o.currentTime)}});o.addEventListener("ended",()=>{if(c.length>0){l=(l+1)%c.length;const e=c[l];v(e.audio,e,l,c)}});f.addEventListener("input",()=>{o.duration&&(o.currentTime=f.value/100*o.duration)});B&&B.addEventListener("click",()=>{o.paused?(o.play(),u.src="/Binks-Melody/Media/Pause-icon.svg",u.alt="Pause"):(o.pause(),u.src="/Binks-Melody/Media/Play-icon.svg",u.alt="Play")});function k(e){const t=Math.floor((e||0)/60),n=Math.floor((e||0)%60);return`${t}:${n<10?"0":""}${n}`}j.addEventListener("click",()=>{if(c.length>0){l=(l-1+c.length)%c.length;const e=c[l];v(e.audio,e,l,c)}});D.addEventListener("click",()=>{if(c.length>0){l=(l+1)%c.length;const e=c[l];v(e.audio,e,l,c)}});P.addEventListener("input",async e=>{const t=e.target.value.trim();if(t.length>2){const n=await q(t);R(n),C.style.display="none",T.style.display="none",m.style.display="flex"}else m.innerHTML="",C.style.display="flex",T.style.display="flex",m.style.display="none"});function U(e,t,n,a,i,s){e.beginPath(),e.moveTo(t+s,n),e.lineTo(t+a-s,n),e.quadraticCurveTo(t+a,n,t+a,n+s),e.lineTo(t+a,n+i-s),e.quadraticCurveTo(t+a,n+i,t+a-s,n+i),e.lineTo(t+s,n+i),e.quadraticCurveTo(t,n+i,t,n+i-s),e.lineTo(t,n+s),e.quadraticCurveTo(t,n,t+s,n),e.closePath(),e.fill()}function M(){if(requestAnimationFrame(M),!r)return;r.getByteFrequencyData(g);const e=document.getElementById("visualizer"),t=e.getContext("2d");e.width=e.offsetWidth,e.height=e.offsetHeight;const n=10,a=35,i=Math.floor(g.length/a),s=e.width/a-n,h=8;t.clearRect(0,0,e.width,e.height);const E=a*s+(a-1)*n,b=(e.width-E)/2;for(let p=0;p<a;p++){const w=g[p*i],L=Math.max(w/255*e.height,h);t.fillStyle="#C2CDB3",U(t,b+p*(s+n),e.height-L,s,L,10)}}M();const y=document.getElementById("player"),F=document.getElementById("player-toggle");F.addEventListener("click",e=>{e.stopPropagation(),y.classList.toggle("minimized")});y.addEventListener("click",e=>{y.classList.contains("minimized")&&(B.contains(e.target)||y.classList.remove("minimized"))});

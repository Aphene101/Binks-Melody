import{b as W,h as M,i as v,j as $,u as U,l as K,e as P,f as X,k as R}from"./firebase-B0uKyTNr.js";const j="804bfeee",I="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8Xw8AAuMBgVdPxT8AAAAASUVORK5CYII=";let f=null;W.onAuthStateChanged(e=>{e&&(f=e.uid)});document.addEventListener("DOMContentLoaded",()=>{window.addEventListener("play-request",t=>{const{track:i,index:d,playlist:a}=t.detail;console.log("Received play-request for:",i.name),h=i,b(i.audio,i,d,a)});const e=document.getElementById("player"),n=document.getElementById("player-toggle"),s=document.getElementById("p-play");if(!e||!n||!s){console.warn("Minimizer setup skipped: missing elements");return}n.addEventListener("click",t=>{t.stopPropagation(),e.classList.toggle("minimized")}),e.addEventListener("click",t=>{e.classList.contains("minimized")&&(s.contains(t.target)||e.classList.remove("minimized"))});const o=document.getElementById("p-add");o&&o.addEventListener("click",q)});const p=document.createElement("div");p.className="song-popup hidden";p.innerHTML=`
  <div class="popup-item" id="addToPlaylistBtn">
    <img src="/Binks-Melody/Media/Purple-Add-Icon.svg" alt="Add">
    <span>Add to Playlist</span>
  </div>
  <hr>
  <div class="popup-item" id="removeFromPlaylistBtn">
    <img src="/Binks-Melody/Media/Delete-Icon.svg" alt="Remove">
     <span>Remove from Playlist</span>
  </div>
`;document.body.appendChild(p);let h=null;async function Q(e){const n=`https://api.jamendo.com/v3.0/tracks/?client_id=${j}&format=json&limit=10&search=${encodeURIComponent(e)}`;return(await(await fetch(n)).json()).results}const S=document.querySelector(".search-input"),A=document.querySelector(".section-title"),C=document.querySelector(".grid-container"),y=document.getElementById("search-results"),c=document.getElementById("player-audio"),E=document.getElementById("play-icon"),T=document.getElementById("p-seek"),_=document.getElementById("p-current"),N=document.getElementById("p-duration"),H=document.getElementById("p-play"),Y=document.getElementById("p-prev"),G=document.getElementById("p-next");let r=[],m=-1,L,g,D,k;function J(e){y.innerHTML="",e.forEach((n,s)=>{const o=document.createElement("div"),t=document.createElement("div");t.classList.add("song-item"),t.innerHTML=`
        <div class="song-left">
            <div class="song-thumb">
            <img src="${n.album_image||I}" alt="Album Art" onerror="this.src='${I}'">
            </div>
            <div class="song-info">
            <span class="song-title">${n.name}</span>
            <span class="song-artist">${n.artist_name}</span>
            </div>
        </div>
        <button class="song-menu">
            <img class="more-icon" src="/Binks-Melody/Media/More-icon.svg">
        </button>
        `,t.querySelector(".song-left").addEventListener("click",()=>{const d=new CustomEvent("play-request",{detail:{track:n,index:s,playlist:e}});window.dispatchEvent(d)}),t.querySelector(".song-menu").addEventListener("click",d=>{d.stopPropagation(),h=n;const a=d.currentTarget.getBoundingClientRect();p.style.top=`${a.bottom+window.scrollY}px`,p.style.left=`${a.left+window.scrollX}px`,p.classList.remove("hidden")}),o.appendChild(t);const i=document.createElement("hr");i.classList.add("song-separator"),o.appendChild(i),y.appendChild(o)})}document.addEventListener("click",e=>{p.contains(e.target)||p.classList.add("hidden")});async function q(){if(p.classList.add("hidden"),!f||!h)return;const e=document.createElement("div");e.className="playlist-chooser";const n=M(v,"users",f,"playlists"),s=await $(n);if(s.empty){const t=document.createElement("div");t.className="playlist-row",t.innerHTML="<p>No playlists found</p>",e.appendChild(t)}else s.docs.forEach((t,i)=>{const d=document.createElement("div");d.className="playlist-row",d.innerHTML=`
            <div class="playlist-icon"></div>
            <p>${t.data().name||"Untitled Playlist"}</p>
            <span class="add-icon"><img src="/Binks-Melody/Media/Add-To-Playlist-icon.svg" alt="Add"></span>
            `;const a=d.querySelector(".playlist-icon"),u=t.data().songs?.[0]?.album_image||t.data().songs?.[0]?.albumArt||t.data().songs?.[0]?.cover||"";if(u?(a.style.backgroundImage=`url(${u})`,a.style.backgroundColor="transparent",a.style.backgroundSize="cover",a.style.backgroundPosition="center"):a.style.backgroundImage="none",d.addEventListener("click",async()=>{await U(P(v,"users",f,"playlists",t.id),{songs:K(h)}),o(e)}),e.appendChild(d),i<s.docs.length-1){const l=document.createElement("hr");l.className="playlist-separator",e.appendChild(l)}});document.body.appendChild(e),e.classList.add("show");function o(t){t.classList.remove("show"),t.classList.add("hide"),t.addEventListener("animationend",()=>t.remove(),{once:!0})}setTimeout(()=>{document.addEventListener("click",()=>o(e),{once:!0})},0)}async function Z(e,n,s){const o=P(v,"users",e,"playlists",n),t=await X(o);if(t.exists()&&Array.isArray(t.data().songs)){const d=(t.data().songs||[]).filter(a=>(a.id??a.audio)!==(s.id??s.audio));await U(o,{songs:d})}else if(s.id)await R(P(v,"users",e,"playlists",n,"songs",s.id));else{const i=M(v,"users",e,"playlists",n,"songs"),a=(await $(i)).docs.find(u=>(u.data().id??u.data().audio)===(s.id??s.audio));a&&await R(a.ref)}}async function x(){if(p.classList.add("hidden"),!f||!h)return;const e=document.createElement("div");e.className="playlist-chooser";const n=M(v,"users",f,"playlists"),s=await $(n);if(s.empty){const t=document.createElement("div");t.className="playlist-row",t.innerHTML="<p>No playlists found</p>",e.appendChild(t)}else s.docs.forEach((t,i)=>{const d=document.createElement("div");d.className="playlist-row",d.innerHTML=`
        <div class="playlist-icon"></div>
        <p>${t.data().name||"Untitled Playlist"}</p>
        <span class="add-icon"><img src="/Binks-Melody/Media/Delete-Icon.svg" alt="Remove"></span>
      `;const a=d.querySelector(".playlist-icon"),u=t.data().songs?.[0]?.album_image||t.data().songs?.[0]?.albumArt||t.data().songs?.[0]?.cover||"";if(u?(a.style.backgroundImage=`url(${u})`,a.style.backgroundColor="transparent",a.style.backgroundSize="cover",a.style.backgroundPosition="center"):a.style.backgroundImage="none",d.addEventListener("click",async()=>{await Z(f,t.id,h),o(e)}),e.appendChild(d),i<s.docs.length-1){const l=document.createElement("hr");l.className="playlist-separator",e.appendChild(l)}});document.body.appendChild(e),e.classList.add("show");function o(t){t.classList.remove("show"),t.classList.add("hide"),t.addEventListener("animationend",()=>t.remove(),{once:!0})}setTimeout(()=>{document.addEventListener("click",()=>o(e),{once:!0})},0)}document.getElementById("addToPlaylistBtn").addEventListener("click",q);document.getElementById("p-add").addEventListener("click",q);document.getElementById("removeFromPlaylistBtn")?.addEventListener("click",x);function ee(){const e=document.getElementById("player-audio");if(e&&!L){L=new(window.AudioContext||window.webkitAudioContext),D=L.createMediaElementSource(e),g=L.createAnalyser(),g.fftSize=256;const n=g.frequencyBinCount;k=new Uint8Array(n),D.connect(g),g.connect(L.destination),F()}}function b(e,n,s,o){const t=document.getElementById("player-audio"),i=document.getElementById("p-title"),d=document.getElementById("p-artist"),a=document.getElementById("play-icon"),u=document.getElementById("p-seek"),l=document.getElementById("p-cover");if(!i||!d||!l||!a||!t||!u){console.warn("Player elements not found");return}i.textContent=n.name,d.textContent=n.artist_name,n.album_image?(l.onerror=()=>l.src=I,l.src=n.album_image):l.src=I,a.src="/Binks-Melody/Media/Pause-icon.svg",document.getElementById("player").classList.add("open"),t.pause();const w=new URL(e),B=`https://jamendo-proxy.aphene-falcon.workers.dev${w.pathname}${w.search}`;t.src=B,t.load(),r=o,m=s,u.value=0,ee(),t.addEventListener("canplay",function V(){t.removeEventListener("canplay",V),t.play().catch(O=>{console.warn("Playback failed:",O)})})}c&&c.addEventListener("loadedmetadata",()=>{N&&(N.textContent=z(c.duration))});c&&c.addEventListener("timeupdate",()=>{if(c.duration){const e=c.currentTime/c.duration*100;T&&(T.value=e),_&&(_.textContent=z(c.currentTime))}});c&&c.addEventListener("ended",()=>{if(r.length>0){m=(m+1)%r.length;const e=r[m];b(e.audio,e,m,r)}});T?.addEventListener("input",()=>{c.duration&&(c.currentTime=T.value/100*c.duration)});H&&c&&E&&H.addEventListener("click",()=>{c.paused?(c.play(),E.src="/Binks-Melody/Media/Pause-icon.svg",E.alt="Pause"):(c.pause(),E.src="/Binks-Melody/Media/Play-icon.svg",E.alt="Play")});function z(e){const n=Math.floor((e||0)/60),s=Math.floor((e||0)%60);return`${n}:${s<10?"0":""}${s}`}Y?.addEventListener("click",()=>{if(r.length>0){m=(m-1+r.length)%r.length;const e=r[m];b(e.audio,e,m,r)}});G?.addEventListener("click",()=>{if(r.length>0){m=(m+1)%r.length;const e=r[m];b(e.audio,e,m,r)}});S&&S.addEventListener("input",async e=>{const n=e.target.value.trim();if(n.length>2){const s=await Q(n);J(s),A&&(A.style.display="none"),C&&(C.style.display="none"),y&&(y.style.display="block")}else y&&(y.innerHTML=""),A&&(A.style.display=""),C&&(C.style.display=""),y&&(y.style.display="none")});function te(e,n,s,o,t,i){e.beginPath(),e.moveTo(n+i,s),e.lineTo(n+o-i,s),e.quadraticCurveTo(n+o,s,n+o,s+i),e.lineTo(n+o,s+t-i),e.quadraticCurveTo(n+o,s+t,n+o-i,s+t),e.lineTo(n+i,s+t),e.quadraticCurveTo(n,s+t,n,s+t-i),e.lineTo(n,s+i),e.quadraticCurveTo(n,s,n+i,s),e.closePath(),e.fill()}function F(){if(requestAnimationFrame(F),!g)return;g.getByteFrequencyData(k);const e=document.getElementById("visualizer"),n=e.getContext("2d");e.width=e.offsetWidth,e.height=e.offsetHeight;const s=8,o=24,t=Math.floor(k.length/o),i=e.width/o-s,d=8;n.clearRect(0,0,e.width,e.height);const a=o*i+(o-1)*s,u=(e.width-a)/2;for(let l=0;l<o;l++){const w=k[l*t],B=Math.max(w/255*e.height,d);n.fillStyle="#C2CDB3",te(n,u+l*(i+s),e.height-B,i,B,6)}}async function se(e,n=10){const s=`https://api.jamendo.com/v3.0/tracks/?client_id=${j}&format=json&limit=${n+6}&tags=${encodeURIComponent(e)}&order=popularity_total&include=musicinfo`,o=await fetch(s);if(!o.ok)throw new Error("Jamendo tag fetch failed");return((await o.json())?.results||[]).map(a=>({id:a.id,name:a.name,artist_name:a.artist_name,album_image:a.album_image,audio:a.audio||a.audiodownload})).filter(a=>!!a.audio).slice(0,n)}export{se as g};

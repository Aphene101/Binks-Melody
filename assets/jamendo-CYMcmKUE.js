import{b as H,i as z,a as b,j as N,u as _,l as D,d as R}from"./firebase-CSKsPba8.js";const U="804bfeee";let h=null;H.onAuthStateChanged(e=>{e&&(h=e.uid)});const u=document.createElement("div");u.className="song-popup hidden";u.innerHTML=`
  <div class="popup-item" id="addToPlaylistBtn">
    <img src="/Binks-Melody/Media/Purple-Add-Icon.svg" alt="Add">
    <span>Add to Playlist</span>
  </div>
`;document.body.appendChild(u);let T=null;async function j(e){const t=`https://api.jamendo.com/v3.0/tracks/?client_id=${U}&format=json&limit=10&search=${encodeURIComponent(e)}`;return(await(await fetch(t)).json()).results}const W=document.querySelector(".search-input"),w=document.querySelector(".section-title"),M=document.querySelector(".grid-container"),v=document.getElementById("search-results"),o=document.getElementById("player-audio"),F=document.getElementById("p-title"),V=document.getElementById("p-artist"),X=document.getElementById("p-cover"),O=document.getElementById("p-current"),Y=document.getElementById("p-duration"),B=document.getElementById("p-seek"),k=document.getElementById("p-play"),G=document.getElementById("p-prev"),J=document.getElementById("p-next"),y=document.getElementById("play-icon");let c=[],d=-1,g,p,P,E;function K(e){v.innerHTML="",e.forEach((t,s)=>{const a=document.createElement("div"),n=document.createElement("div");n.classList.add("song-item"),n.innerHTML=`
        <div class="song-left">
            <div class="song-thumb">
            <img src="${t.album_image}" alt="Album Art">
            </div>
            <div class="song-info">
            <span class="song-title">${t.name}</span>
            <span class="song-artist">${t.artist_name}</span>
            </div>
        </div>
        <button class="song-menu">
            <img class="more-icon" src="/Binks-Melody/Media/More-icon.svg">
        </button>
        `,n.querySelector(".song-left").addEventListener("click",()=>{C(t.audio,t,s,e)}),n.querySelector(".song-menu").addEventListener("click",l=>{l.stopPropagation(),T=t;const r=l.currentTarget.getBoundingClientRect();u.style.top=`${r.bottom+window.scrollY}px`,u.style.left=`${r.left+window.scrollX}px`,u.classList.remove("hidden")}),a.appendChild(n);const i=document.createElement("hr");i.classList.add("song-separator"),a.appendChild(i),v.appendChild(a)})}document.addEventListener("click",e=>{u.contains(e.target)||u.classList.add("hidden")});async function $(){if(u.classList.add("hidden"),!h||!T)return;const e=document.createElement("div");e.className="playlist-chooser";const t=z(b,"users",h,"playlists"),s=await N(t);if(s.empty){const n=document.createElement("div");n.className="playlist-row",n.innerHTML="<p>No playlists found</p>",e.appendChild(n)}else s.docs.forEach((n,i)=>{const l=document.createElement("div");l.className="playlist-row",l.innerHTML=`
            <div class="playlist-icon"></div>
            <p>${n.data().name||"Untitled Playlist"}</p>
            <span class="add-icon"><img src="/Binks-Melody/Media/Add-To-Playlist-icon.svg" alt="Add"></span>
            `;const r=l.querySelector(".playlist-icon"),f=n.data().songs?.[0]?.album_image||n.data().songs?.[0]?.albumArt||n.data().songs?.[0]?.cover||"";if(f?(r.style.backgroundImage=`url(${f})`,r.style.backgroundColor="transparent",r.style.backgroundSize="cover",r.style.backgroundPosition="center"):r.style.backgroundImage="none",l.addEventListener("click",async()=>{await _(R(b,"users",h,"playlists",n.id),{songs:D(T)}),a(e)}),e.appendChild(l),i<s.docs.length-1){const m=document.createElement("hr");m.className="playlist-separator",e.appendChild(m)}});document.body.appendChild(e),e.classList.add("show");function a(n){n.classList.remove("show"),n.classList.add("hide"),n.addEventListener("animationend",()=>n.remove(),{once:!0})}setTimeout(()=>{document.addEventListener("click",()=>a(e),{once:!0})},0)}document.getElementById("addToPlaylistBtn").addEventListener("click",$);document.getElementById("p-add").addEventListener("click",$);function Q(){if(!g){g=new(window.AudioContext||window.webkitAudioContext),P=g.createMediaElementSource(o),p=g.createAnalyser(),p.fftSize=256;const e=p.frequencyBinCount;E=new Uint8Array(e),P.connect(p),p.connect(g.destination)}}function C(e,t,s,a){F.textContent=t.name,V.textContent=t.artist_name,X.src=t.album_image,y.src="/Binks-Melody/Media/Pause-icon.svg",document.getElementById("player").classList.add("open"),o.pause();const n=new URL(e),i=`https://jamendo-proxy.aphene-falcon.workers.dev${n.pathname}${n.search}`;o.src=i,o.load(),c=a,d=s,B.value=0,Q(),o.addEventListener("canplay",function l(){o.removeEventListener("canplay",l),o.play().catch(r=>{console.warn("Playback failed:",r)})})}o.addEventListener("loadedmetadata",()=>{Y.textContent=A(o.duration)});o.addEventListener("timeupdate",()=>{if(o.duration){const e=o.currentTime/o.duration*100;B.value=e,O.textContent=A(o.currentTime)}});o.addEventListener("ended",()=>{if(c.length>0){d=(d+1)%c.length;const e=c[d];C(e.audio,e,d,c)}});B.addEventListener("input",()=>{o.duration&&(o.currentTime=B.value/100*o.duration)});k&&k.addEventListener("click",()=>{o.paused?(o.play(),y.src="/Binks-Melody/Media/Pause-icon.svg",y.alt="Pause"):(o.pause(),y.src="/Binks-Melody/Media/Play-icon.svg",y.alt="Play")});function A(e){const t=Math.floor((e||0)/60),s=Math.floor((e||0)%60);return`${t}:${s<10?"0":""}${s}`}G.addEventListener("click",()=>{if(c.length>0){d=(d-1+c.length)%c.length;const e=c[d];C(e.audio,e,d,c)}});J.addEventListener("click",()=>{if(c.length>0){d=(d+1)%c.length;const e=c[d];C(e.audio,e,d,c)}});W.addEventListener("input",async e=>{const t=e.target.value.trim();if(t.length>2){const s=await j(t);K(s),w.style.display="none",M.style.display="none",v.style.display="flex"}else v.innerHTML="",w.style.display="flex",M.style.display="flex",v.style.display="none"});function Z(e,t,s,a,n,i){e.beginPath(),e.moveTo(t+i,s),e.lineTo(t+a-i,s),e.quadraticCurveTo(t+a,s,t+a,s+i),e.lineTo(t+a,s+n-i),e.quadraticCurveTo(t+a,s+n,t+a-i,s+n),e.lineTo(t+i,s+n),e.quadraticCurveTo(t,s+n,t,s+n-i),e.lineTo(t,s+i),e.quadraticCurveTo(t,s,t+i,s),e.closePath(),e.fill()}function q(){if(requestAnimationFrame(q),!p)return;p.getByteFrequencyData(E);const e=document.getElementById("visualizer"),t=e.getContext("2d");e.width=e.offsetWidth,e.height=e.offsetHeight;const s=10,a=35,n=Math.floor(E.length/a),i=e.width/a-s,l=8;t.clearRect(0,0,e.width,e.height);const r=a*i+(a-1)*s,f=(e.width-r)/2;for(let m=0;m<a;m++){const S=E[m*n],I=Math.max(S/255*e.height,l);t.fillStyle="#C2CDB3",Z(t,f+m*(i+s),e.height-I,i,I,10)}}q();const L=document.getElementById("player"),x=document.getElementById("player-toggle");x.addEventListener("click",e=>{e.stopPropagation(),L.classList.toggle("minimized")});L.addEventListener("click",e=>{L.classList.contains("minimized")&&(k.contains(e.target)||L.classList.remove("minimized"))});

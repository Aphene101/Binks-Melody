import{b as W,h as M,i as h,j as $,u as U,l as K,e as P,f as X,k as R}from"./firebase-Bf4RwclJ.js";const j="804bfeee",T="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8Xw8AAuMBgVdPxT8AAAAASUVORK5CYII=";let f=null;W.onAuthStateChanged(e=>{e&&(f=e.uid)});document.addEventListener("DOMContentLoaded",()=>{window.addEventListener("play-request",n=>{const{track:o,index:d,playlist:i}=n.detail;console.log("Received play-request for:",o.name),v=o,I(o.audio,o,d,i)});const e=document.getElementById("player"),t=document.getElementById("player-toggle"),s=document.getElementById("p-play");if(!e||!t||!s){console.warn("Minimizer setup skipped: missing elements");return}t.addEventListener("click",n=>{n.stopPropagation(),e.classList.toggle("minimized")}),e.addEventListener("click",n=>{e.classList.contains("minimized")&&(s.contains(n.target)||e.classList.remove("minimized"))});const a=document.getElementById("p-add");a&&a.addEventListener("click",_)});const p=document.createElement("div");p.className="song-popup hidden";p.innerHTML=`
  <div class="popup-item" id="addToPlaylistBtn">
    <img src="/Binks-Melody/Media/Purple-Add-Icon.svg" alt="Add">
    <span>Add to Playlist</span>
  </div>
  <hr>
  <div class="popup-item" id="removeFromPlaylistBtn">
    <img src="/Binks-Melody/Media/Delete-Icon.svg" alt="Remove">
     <span>Remove from Playlist</span>
  </div>
`;document.body.appendChild(p);let v=null;async function Q(e){const t=`https://api.jamendo.com/v3.0/tracks/?client_id=${j}&format=json&limit=10&search=${encodeURIComponent(e)}`;return(await(await fetch(t)).json()).results}const q=document.querySelector(".search-input"),B=document.querySelector(".section-title"),C=document.querySelector(".grid-container"),y=document.getElementById("search-results"),l=document.getElementById("player-audio"),E=document.getElementById("play-icon"),b=document.getElementById("p-seek"),S=document.getElementById("p-current"),N=document.getElementById("p-duration"),H=document.getElementById("p-play"),Y=document.getElementById("p-prev"),G=document.getElementById("p-next");let c=[],m=-1,w,g,D,k;function J(e){y.innerHTML="",e.forEach((t,s)=>{const a=document.createElement("div"),n=document.createElement("div");n.classList.add("song-item"),n.innerHTML=`
        <div class="song-left">
            <div class="song-thumb">
            <img src="${t.album_image||T}" alt="Album Art" onerror="this.src='${T}'">
            </div>
            <div class="song-info">
            <span class="song-title">${t.name}</span>
            <span class="song-artist">${t.artist_name}</span>
            </div>
        </div>
        <button class="song-menu">
            <img class="more-icon" src="/Binks-Melody/Media/More-icon.svg">
        </button>
        `,n.querySelector(".song-left").addEventListener("click",()=>{const d=new CustomEvent("play-request",{detail:{track:t,index:s,playlist:e}});window.dispatchEvent(d)}),n.querySelector(".song-menu").addEventListener("click",d=>{d.stopPropagation(),v=t;const i=d.currentTarget.getBoundingClientRect();p.style.top=`${i.bottom+window.scrollY}px`,p.style.left=`${i.left+window.scrollX}px`,p.classList.remove("hidden")}),a.appendChild(n);const o=document.createElement("hr");o.classList.add("song-separator"),a.appendChild(o),y.appendChild(a)})}document.addEventListener("click",e=>{p.contains(e.target)||p.classList.add("hidden")});async function _(){if(p.classList.add("hidden"),!f||!v)return;const e=document.createElement("div");e.className="playlist-chooser";const t=M(h,"users",f,"playlists"),s=await $(t);if(s.empty){const a=document.createElement("div");a.className="playlist-row",a.innerHTML="<p>No playlists found</p>",e.appendChild(a)}else s.docs.forEach((a,n)=>{const o=document.createElement("div");o.className="playlist-row",o.innerHTML=`
            <div class="playlist-icon"></div>
            <p>${a.data().name||"Untitled Playlist"}</p>
            <span class="add-icon"><img src="/Binks-Melody/Media/Add-To-Playlist-icon.svg" alt="Add"></span>
            `;const d=o.querySelector(".playlist-icon"),i=a.data().songs?.[0]?.album_image||a.data().songs?.[0]?.albumArt||a.data().songs?.[0]?.cover||"";if(i?(d.style.backgroundImage=`url(${i})`,d.style.backgroundColor="transparent",d.style.backgroundSize="cover",d.style.backgroundPosition="center"):d.style.backgroundImage="none",o.addEventListener("click",async()=>{await U(P(h,"users",f,"playlists",a.id),{songs:K(v)}),slideOutAndRemove(e)}),e.appendChild(o),n<s.docs.length-1){const r=document.createElement("hr");r.className="playlist-separator",e.appendChild(r)}});document.body.appendChild(e),e.classList.add("show"),setTimeout(()=>{document.addEventListener("click",()=>slideOutAndRemove(e),{once:!0})},0)}window.__bmSetCurrentTrack=e=>{v=e};window.__bmAddToPlaylist=()=>{_()};async function Z(e,t,s){const a=P(h,"users",e,"playlists",t),n=await X(a);if(n.exists()&&Array.isArray(n.data().songs)){const d=(n.data().songs||[]).filter(i=>(i.id??i.audio)!==(s.id??s.audio));await U(a,{songs:d})}else if(s.id)await R(P(h,"users",e,"playlists",t,"songs",s.id));else{const o=M(h,"users",e,"playlists",t,"songs"),i=(await $(o)).docs.find(r=>(r.data().id??r.data().audio)===(s.id??s.audio));i&&await R(i.ref)}}async function x(){if(p.classList.add("hidden"),!f||!v)return;const e=document.createElement("div");e.className="playlist-chooser";const t=M(h,"users",f,"playlists"),s=await $(t);if(s.empty){const n=document.createElement("div");n.className="playlist-row",n.innerHTML="<p>No playlists found</p>",e.appendChild(n)}else s.docs.forEach((n,o)=>{const d=document.createElement("div");d.className="playlist-row",d.innerHTML=`
        <div class="playlist-icon"></div>
        <p>${n.data().name||"Untitled Playlist"}</p>
        <span class="add-icon"><img src="/Binks-Melody/Media/Delete-Icon.svg" alt="Remove"></span>
      `;const i=d.querySelector(".playlist-icon"),r=n.data().songs?.[0]?.album_image||n.data().songs?.[0]?.albumArt||n.data().songs?.[0]?.cover||"";if(r?(i.style.backgroundImage=`url(${r})`,i.style.backgroundColor="transparent",i.style.backgroundSize="cover",i.style.backgroundPosition="center"):i.style.backgroundImage="none",d.addEventListener("click",async()=>{await Z(f,n.id,v),a(e)}),e.appendChild(d),o<s.docs.length-1){const u=document.createElement("hr");u.className="playlist-separator",e.appendChild(u)}});document.body.appendChild(e),e.classList.add("show");function a(n){n.classList.remove("show"),n.classList.add("hide"),n.addEventListener("animationend",()=>n.remove(),{once:!0})}setTimeout(()=>{document.addEventListener("click",()=>a(e),{once:!0})},0)}document.getElementById("addToPlaylistBtn").addEventListener("click",_);document.getElementById("removeFromPlaylistBtn")?.addEventListener("click",x);function ee(){const e=document.getElementById("player-audio");if(e&&!w){w=new(window.AudioContext||window.webkitAudioContext),D=w.createMediaElementSource(e),g=w.createAnalyser(),g.fftSize=256;const t=g.frequencyBinCount;k=new Uint8Array(t),D.connect(g),g.connect(w.destination),F()}}function I(e,t,s,a){const n=document.getElementById("player-audio"),o=document.getElementById("p-title"),d=document.getElementById("p-artist"),i=document.getElementById("play-icon"),r=document.getElementById("p-seek"),u=document.getElementById("p-cover");if(!o||!d||!u||!i||!n||!r){console.warn("Player elements not found");return}o.textContent=t.name,d.textContent=t.artist_name,t.album_image?(u.onerror=()=>u.src=T,u.src=t.album_image):u.src=T,i.src="/Binks-Melody/Media/Pause-icon.svg",document.getElementById("player").classList.add("open"),n.pause();const A=new URL(e),L=`https://jamendo-proxy.aphene-falcon.workers.dev${A.pathname}${A.search}`;n.src=L,n.load(),c=a,m=s,r.value=0,ee(),n.addEventListener("canplay",function O(){n.removeEventListener("canplay",O),n.play().catch(V=>{console.warn("Playback failed:",V)})})}l&&l.addEventListener("loadedmetadata",()=>{N&&(N.textContent=z(l.duration))});l&&l.addEventListener("timeupdate",()=>{if(l.duration){const e=l.currentTime/l.duration*100;b&&(b.value=e),S&&(S.textContent=z(l.currentTime))}});l&&l.addEventListener("ended",()=>{if(c.length>0){m=(m+1)%c.length;const e=c[m];I(e.audio,e,m,c)}});b?.addEventListener("input",()=>{l.duration&&(l.currentTime=b.value/100*l.duration)});H&&l&&E&&H.addEventListener("click",()=>{l.paused?(l.play(),E.src="/Binks-Melody/Media/Pause-icon.svg",E.alt="Pause"):(l.pause(),E.src="/Binks-Melody/Media/Play-icon.svg",E.alt="Play")});function z(e){const t=Math.floor((e||0)/60),s=Math.floor((e||0)%60);return`${t}:${s<10?"0":""}${s}`}Y?.addEventListener("click",()=>{if(c.length>0){m=(m-1+c.length)%c.length;const e=c[m];I(e.audio,e,m,c)}});G?.addEventListener("click",()=>{if(c.length>0){m=(m+1)%c.length;const e=c[m];I(e.audio,e,m,c)}});q&&q.addEventListener("input",async e=>{const t=e.target.value.trim();if(t.length>2){const s=await Q(t);J(s),B&&(B.style.display="none"),C&&(C.style.display="none"),y&&(y.style.display="block")}else y&&(y.innerHTML=""),B&&(B.style.display=""),C&&(C.style.display=""),y&&(y.style.display="none")});function te(e,t,s,a,n,o){e.beginPath(),e.moveTo(t+o,s),e.lineTo(t+a-o,s),e.quadraticCurveTo(t+a,s,t+a,s+o),e.lineTo(t+a,s+n-o),e.quadraticCurveTo(t+a,s+n,t+a-o,s+n),e.lineTo(t+o,s+n),e.quadraticCurveTo(t,s+n,t,s+n-o),e.lineTo(t,s+o),e.quadraticCurveTo(t,s,t+o,s),e.closePath(),e.fill()}function F(){if(requestAnimationFrame(F),!g)return;g.getByteFrequencyData(k);const e=document.getElementById("visualizer"),t=e.getContext("2d");e.width=e.offsetWidth,e.height=e.offsetHeight;const s=8,a=24,n=Math.floor(k.length/a),o=e.width/a-s,d=8;t.clearRect(0,0,e.width,e.height);const i=a*o+(a-1)*s,r=(e.width-i)/2;for(let u=0;u<a;u++){const A=k[u*n],L=Math.max(A/255*e.height,d);t.fillStyle="#C2CDB3",te(t,r+u*(o+s),e.height-L,o,L,6)}}async function se(e,t=10){const s=`https://api.jamendo.com/v3.0/tracks/?client_id=${j}&format=json&limit=${t+6}&tags=${encodeURIComponent(e)}&order=popularity_total&include=musicinfo`,a=await fetch(s);if(!a.ok)throw new Error("Jamendo tag fetch failed");return((await a.json())?.results||[]).map(i=>({id:i.id,name:i.name,artist_name:i.artist_name,album_image:i.album_image,audio:i.audio||i.audiodownload})).filter(i=>!!i.audio).slice(0,t)}export{se as g};

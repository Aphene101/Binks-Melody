import{b as U,f as j,h as M,i as W,u as F,k as O,d as V}from"./firebase-BJqLWyn6.js";const X="804bfeee";let k=null;U.onAuthStateChanged(e=>{e&&(k=e.uid)});document.addEventListener("DOMContentLoaded",()=>{window.addEventListener("play-request",t=>{const{track:s,index:d,playlist:l}=t.detail;console.log("Received play-request for:",s.name),I=s,w(s.audio,s,d,l)});const e=document.getElementById("player"),n=document.getElementById("player-toggle"),a=document.getElementById("p-play");if(!e||!n||!a){console.warn("Minimizer setup skipped: missing elements");return}n.addEventListener("click",t=>{t.stopPropagation(),e.classList.toggle("minimized")}),e.addEventListener("click",t=>{e.classList.contains("minimized")&&(a.contains(t.target)||e.classList.remove("minimized"))});const o=document.getElementById("p-add");o&&o.addEventListener("click",b)});const m=document.createElement("div");m.className="song-popup hidden";m.innerHTML=`
  <div class="popup-item" id="addToPlaylistBtn">
    <img src="/Binks-Melody/Media/Purple-Add-Icon.svg" alt="Add">
    <span>Add to Playlist</span>
  </div>
`;document.body.appendChild(m);let I=null;async function Y(e){const n=`https://api.jamendo.com/v3.0/tracks/?client_id=${X}&format=json&limit=10&search=${encodeURIComponent(e)}`;return(await(await fetch(n)).json()).results}const P=document.querySelector(".search-input"),L=document.querySelector(".section-title"),B=document.querySelector(".grid-container"),p=document.getElementById("search-results"),i=document.getElementById("player-audio"),f=document.getElementById("play-icon"),T=document.getElementById("p-seek"),$=document.getElementById("p-current"),A=document.getElementById("p-duration"),q=document.getElementById("p-play"),G=document.getElementById("p-prev"),J=document.getElementById("p-next");let c=[],r=-1,v,g,S,C;function K(e){p.innerHTML="",e.forEach((n,a)=>{const o=document.createElement("div"),t=document.createElement("div");t.classList.add("song-item"),t.innerHTML=`
        <div class="song-left">
            <div class="song-thumb">
            <img src="${n.album_image}" alt="Album Art">
            </div>
            <div class="song-info">
            <span class="song-title">${n.name}</span>
            <span class="song-artist">${n.artist_name}</span>
            </div>
        </div>
        <button class="song-menu">
            <img class="more-icon" src="/Binks-Melody/Media/More-icon.svg">
        </button>
        `,t.querySelector(".song-left").addEventListener("click",()=>{const d=new CustomEvent("play-request",{detail:{track:n,index:a,playlist:e}});window.dispatchEvent(d)}),t.querySelector(".song-menu").addEventListener("click",d=>{d.stopPropagation(),I=n;const l=d.currentTarget.getBoundingClientRect();m.style.top=`${l.bottom+window.scrollY}px`,m.style.left=`${l.left+window.scrollX}px`,m.classList.remove("hidden")}),o.appendChild(t);const s=document.createElement("hr");s.classList.add("song-separator"),o.appendChild(s),p.appendChild(o)})}document.addEventListener("click",e=>{m.contains(e.target)||m.classList.add("hidden")});async function b(){if(m.classList.add("hidden"),!k||!I)return;const e=document.createElement("div");e.className="playlist-chooser";const n=j(M,"users",k,"playlists"),a=await W(n);if(a.empty){const t=document.createElement("div");t.className="playlist-row",t.innerHTML="<p>No playlists found</p>",e.appendChild(t)}else a.docs.forEach((t,s)=>{const d=document.createElement("div");d.className="playlist-row",d.innerHTML=`
            <div class="playlist-icon"></div>
            <p>${t.data().name||"Untitled Playlist"}</p>
            <span class="add-icon"><img src="/Binks-Melody/Media/Add-To-Playlist-icon.svg" alt="Add"></span>
            `;const l=d.querySelector(".playlist-icon"),y=t.data().songs?.[0]?.album_image||t.data().songs?.[0]?.albumArt||t.data().songs?.[0]?.cover||"";if(y?(l.style.backgroundImage=`url(${y})`,l.style.backgroundColor="transparent",l.style.backgroundSize="cover",l.style.backgroundPosition="center"):l.style.backgroundImage="none",d.addEventListener("click",async()=>{await F(V(M,"users",k,"playlists",t.id),{songs:O(I)}),o(e)}),e.appendChild(d),s<a.docs.length-1){const u=document.createElement("hr");u.className="playlist-separator",e.appendChild(u)}});document.body.appendChild(e),e.classList.add("show");function o(t){t.classList.remove("show"),t.classList.add("hide"),t.addEventListener("animationend",()=>t.remove(),{once:!0})}setTimeout(()=>{document.addEventListener("click",()=>o(e),{once:!0})},0)}const z=document.getElementById("addToPlaylistBtn");z&&z.addEventListener("click",b);const H=document.getElementById("p-add");H&&H.addEventListener("click",b);function Q(){const e=document.getElementById("player-audio");if(e&&!v){v=new(window.AudioContext||window.webkitAudioContext),S=v.createMediaElementSource(e),g=v.createAnalyser(),g.fftSize=256;const n=g.frequencyBinCount;C=new Uint8Array(n),S.connect(g),g.connect(v.destination),N()}}function w(e,n,a,o){const t=document.getElementById("player-audio"),s=document.getElementById("p-title"),d=document.getElementById("p-artist"),l=document.getElementById("play-icon"),y=document.getElementById("p-seek"),u=document.getElementById("p-cover");if(!s||!d||!u||!l||!t||!y){console.warn("Player elements not found");return}s.textContent=n.name,d.textContent=n.artist_name,u.src=n.album_image,l.src="/Binks-Melody/Media/Pause-icon.svg",document.getElementById("player").classList.add("open"),t.pause();const E=new URL(e),h=`https://jamendo-proxy.aphene-falcon.workers.dev${E.pathname}${E.search}`;t.src=h,t.load(),c=o,r=a,y.value=0,Q(),t.addEventListener("canplay",function R(){t.removeEventListener("canplay",R),t.play().catch(_=>{console.warn("Playback failed:",_)})})}i&&i.addEventListener("loadedmetadata",()=>{A&&(A.textContent=D(i.duration))});i&&i.addEventListener("timeupdate",()=>{if(i.duration){const e=i.currentTime/i.duration*100;T&&(T.value=e),$&&($.textContent=D(i.currentTime))}});i&&i.addEventListener("ended",()=>{if(c.length>0){r=(r+1)%c.length;const e=c[r];w(e.audio,e,r,c)}});T?.addEventListener("input",()=>{i.duration&&(i.currentTime=T.value/100*i.duration)});q&&i&&f&&q.addEventListener("click",()=>{i.paused?(i.play(),f.src="/Binks-Melody/Media/Pause-icon.svg",f.alt="Pause"):(i.pause(),f.src="/Binks-Melody/Media/Play-icon.svg",f.alt="Play")});function D(e){const n=Math.floor((e||0)/60),a=Math.floor((e||0)%60);return`${n}:${a<10?"0":""}${a}`}G?.addEventListener("click",()=>{if(c.length>0){r=(r-1+c.length)%c.length;const e=c[r];w(e.audio,e,r,c)}});J?.addEventListener("click",()=>{if(c.length>0){r=(r+1)%c.length;const e=c[r];w(e.audio,e,r,c)}});P&&P.addEventListener("input",async e=>{const n=e.target.value.trim();if(n.length>2){const a=await Y(n);K(a),L&&(L.style.display="none"),B&&(B.style.display="none"),p&&(p.style.display="flex")}else p&&(p.innerHTML=""),L&&(L.style.display="flex"),B&&(B.style.display="flex"),p&&(p.style.display="none")});function Z(e,n,a,o,t,s){e.beginPath(),e.moveTo(n+s,a),e.lineTo(n+o-s,a),e.quadraticCurveTo(n+o,a,n+o,a+s),e.lineTo(n+o,a+t-s),e.quadraticCurveTo(n+o,a+t,n+o-s,a+t),e.lineTo(n+s,a+t),e.quadraticCurveTo(n,a+t,n,a+t-s),e.lineTo(n,a+s),e.quadraticCurveTo(n,a,n+s,a),e.closePath(),e.fill()}function N(){if(requestAnimationFrame(N),!g)return;g.getByteFrequencyData(C);const e=document.getElementById("visualizer"),n=e.getContext("2d");e.width=e.offsetWidth,e.height=e.offsetHeight;const a=10,o=35,t=Math.floor(C.length/o),s=e.width/o-a,d=8;n.clearRect(0,0,e.width,e.height);const l=o*s+(o-1)*a,y=(e.width-l)/2;for(let u=0;u<o;u++){const E=C[u*t],h=Math.max(E/255*e.height,d);n.fillStyle="#C2CDB3",Z(n,y+u*(s+a),e.height-h,s,h,10)}}
